<!DOCTYPE html>
<html lang="hi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§¨‡§°‡§º‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§π‡§∏‡§æ‡§Æ‡§™‡•Å‡§∞</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;500;600;700;800&family=Gotu&family=Hind:wght@300;400;500;600;700&family=Kalam:wght@300;400;700&family=Martel:wght@300;400;700&family=Mukta:wght@300;400;600;700&family=Noto+Sans+Devanagari:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600&family=Tiro+Devanagari+Hindi:ital@0;1&family=Yatra+One&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Tailwind Config -->
    <script src="/theme.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/src/index.css"> 

    <style>
        /* Keeping your original styles intact */
        :root {
            --primary: #ea580c;
            --secondary: #facc15;
            --bg: #fff7ed;
            --text: #1f2937;
            --glass: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.3);
            --font-primary: 'Noto Sans Devanagari';
            --heading-font: var(--font-primary);
            --body-font: var(--font-primary);
            --shloka-font: 'Noto Sans Devanagari';
            --shloka-color: #facc15;
            --font-size-base: 16px;
            --side-nav-width: 260px;
        }

        html.dark {
            --bg: #0a0a0a;
            --text: #ffffff;
            --glass: rgba(20, 20, 20, 0.3);
            --glass-border: rgba(255, 255, 255, 0.05);
            --primary: #fb923c;
        }

        h1, h2, h3, h4, h5, h6 { font-family: var(--heading-font), serif; }

        body {
            font-family: var(--body-font), sans-serif;
            background-color: var(--bg);
            color: var(--text);
            font-size: var(--font-size-base);
            transition: background-color 0.5s cubic-bezier(0.4, 0, 0.2, 1), color 0.3s ease;
            background-image: 
                radial-gradient(at 0% 0%, rgba(234, 88, 12, 0.1) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(234, 88, 12, 0.05) 0px, transparent 50%);
            background-attachment: fixed;
        }
        
        ::selection { background-color: var(--primary); color: white; }
        .sanskrit { font-family: var(--shloka-font), serif; color: var(--shloka-color); font-style: italic; }

        .glass-panel {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.8s ease-out forwards; }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin-slow 8s linear infinite; animation-play-state: paused; }
        @keyframes bounce-x { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(5px); } }
        .animate-bounce-x { animation: bounce-x 1s infinite; }
        @keyframes pulse-green { 0% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(74, 222, 128, 0); } 100% { box-shadow: 0 0 0 0 rgba(74, 222, 128, 0); } }
        .animate-pulse-green { animation: pulse-green 2s infinite; }

        html { overflow-y: overlay; }
        ::-webkit-scrollbar { width: 10px; background: transparent; }
        ::-webkit-scrollbar-track { background: transparent; margin-block: 4px; }
        ::-webkit-scrollbar-thumb { background-color: rgba(128, 128, 128, 0.3); border-radius: 10px; border: 2px solid transparent; background-clip: content-box; backdrop-filter: blur(5px); }
        ::-webkit-scrollbar-thumb:hover { background-color: rgba(128, 128, 128, 0.6); }

        .hide { display: none !important; }
        .fullscreen-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 3000; display: flex; justify-content: center; align-items: center; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 2500; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(5px); }

        .dock-nav { width: 90%; max-width: 800px; left: 50%; transform: translateX(-50%); bottom: 20px; border-radius: 2rem; padding: 0.5rem 1rem; box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.2); }
        @media (min-width: 768px) { .dock-nav { width: 70%; } }
        .dock-item { transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .dock-item:hover { transform: scale(1.2) translateY(-10px); }
        .dock-item.active { color: var(--primary); transform: translateY(-5px); }
        .dock-item.active i { text-shadow: 0 0 10px var(--primary); }

        .nav-btn.active { color: var(--primary); font-weight: bold; background-color: rgba(255, 255, 255, 0.1); border-left: 3px solid var(--primary); }
        #top-nav .nav-btn.active { border-left: none; border-bottom: 2px solid var(--primary); }

        .flower { position: absolute; top: -50px; font-size: 24px; animation: fall linear forwards; pointer-events: none; z-index: 20; color: #ff9900; text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); }
        @keyframes fall { to { transform: translateY(500px) rotate(360deg); opacity: 0; } }

        .ticker-wrap { width: 100%; overflow: hidden; background: var(--primary); color: white; padding: 5px 0; font-size: 0.9rem; font-weight: bold; position: relative; z-index: 30; }
        .ticker { display: inline-block; white-space: nowrap; animation: ticker 20s linear infinite; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .toast { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; padding: 12px 24px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); z-index: 10000; transform: translateY(100px); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .toast.show { transform: translateY(0); }

        @keyframes zoomIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-zoom-in { animation: zoomIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }

        #side-nav-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(5px); z-index: 45; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        body.nav-side-mobile-active #side-nav-overlay { opacity: 1; pointer-events: auto; }
        body.nav-side-mobile-active { overflow: hidden; }

        .burger-icon { transition: transform 0.3s ease; }
        .burger-icon.open { transform: rotate(90deg); }

        #welcome-popup { position: fixed; top: 80px; right: 20px; background: var(--primary); color: white; padding: 10px 15px; border-radius: 8px; font-size: 0.85rem; font-weight: bold; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3); z-index: 200; display: flex; align-items: center; gap: 10px; animation: bounce-x 2s infinite; }
        #welcome-popup::after { content: ''; position: absolute; top: -6px; right: 20px; width: 12px; height: 12px; background: var(--primary); transform: rotate(45deg); }

        #global-player-ui { transition: width 0.5s ease-in-out, transform 0.3s ease, border-radius 0.5s ease; overflow: hidden; }
        .player-collapsed { width: 50px !important; height: 50px !important; padding: 0 !important; border-radius: 50% !important; background: transparent !important; border: none !important; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3) !important; }
        .player-collapsed .player-controls, .player-collapsed .player-info, .player-collapsed .player-minimize-btn { display: none !important; }
        .player-collapsed .player-art-container { width: 100%; height: 100%; border: 2px solid var(--secondary); }
        
        body.nav-side #global-player-ui { position: static; width: 100%; box-shadow: none; background: rgba(0, 0, 0, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); margin-top: 10px; padding: 10px; border-radius: 12px; }
        body.nav-side #global-player-ui .player-minimize-btn { display: none; }

        .player-art-container:hover::after { content: '\f0ca'; font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute; inset: 0; background: rgba(0, 0, 0, 0.7); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; cursor: pointer; border-radius: 50%; backdrop-filter: blur(2px); transition: opacity 0.3s; }

        body.aarti-mode { cursor: none; }
        #aarti-cursor { position: fixed; pointer-events: none; z-index: 9999; font-size: 3rem; transform: translate(-50%, -50%); filter: drop-shadow(0 0 10px gold); }
        .sparkle { position: fixed; background: white; border-radius: 50%; pointer-events: none; z-index: 9998; animation: fadeOut 1s forwards; }
        .floating-diya { position: fixed; font-size: 2rem; animation: floatUp 4s ease-in forwards; pointer-events: none; z-index: 80; filter: drop-shadow(0 0 8px orange); }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 0; } 10% { opacity: 1; } 100% { transform: translateY(-300px) scale(1.5); opacity: 0; } }
        @keyframes fadeOut { to { opacity: 0; transform: scale(0); } }

        .mala-bead { transition: transform 0.1s; }
        .mala-bead:active { transform: scale(0.9); }

        #side-nav-resizer { position: absolute; top: 0; right: 0; width: 5px; height: 100%; cursor: col-resize; background: transparent; z-index: 100; transition: background 0.2s; }
        #side-nav-resizer:hover, #side-nav-resizer.active { background: var(--primary); opacity: 0.5; }
        .no-transition { transition: none !important; }
        #mobile-menu { transition: transform 0.3s ease-in-out; }
    </style>
</head>

<body class="min-h-screen overflow-x-hidden relative nav-top">

    <!-- AUDIO ELEMENT & BELL -->
    <audio id="global-audio-player" preload="auto" onended="audioNext()"></audio>
    <audio id="bell-sound" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3" preload="auto"></audio>
    <audio id="bead-sound" src="https://www.soundjay.com/button/sounds/button-16.mp3" preload="auto"></audio>

    <!-- SIDE NAV OVERLAY -->
    <div id="side-nav-overlay" onclick="toggleSideNav()"></div>

    <!-- PLAYER OVERLAY -->
    <div id="player-overlay" class="hide fixed inset-0 z-[3000] flex items-center justify-center bg-black/80 backdrop-blur-md" onclick="togglePlayerOverlay()">
        <div class="glass-panel w-[90%] max-w-lg p-8 rounded-3xl animate-zoom-in relative bg-white/10" onclick="event.stopPropagation()">
            <button onclick="togglePlayerOverlay()" class="absolute top-4 right-4 text-white text-2xl hover:text-red-500"><i class="fas fa-times"></i></button>
            <div class="text-center mb-6">
                <div class="w-32 h-32 md:w-48 md:h-48 rounded-full border-4 border-primary mx-auto mb-4 overflow-hidden shadow-2xl relative">
                    <img id="overlay-art" src="https://images.unsplash.com/photo-1582236894372-a4f65342898c?q=80" class="w-full h-full object-cover animate-spin-slow">
                    <div class="absolute inset-0 flex items-center justify-center bg-black/20"><i class="fas fa-music text-3xl text-white/80"></i></div>
                </div>
                <h3 id="overlay-title" class="text-2xl font-bold text-white mb-1">Loading...</h3>
                <p class="text-white/60 text-sm">Bhajan Player</p>
            </div>
            <div class="flex items-center justify-center gap-6 mb-8">
                <button onclick="audioPrev(event)" class="text-white hover:text-primary text-2xl"><i class="fas fa-step-backward"></i></button>
                <button onclick="audioToggle(event)" id="overlay-play-btn" class="w-14 h-14 rounded-full bg-primary text-white flex items-center justify-center hover:scale-110 transition shadow-lg text-xl"><i class="fas fa-play pl-1"></i></button>
                <button onclick="audioNext(event)" class="text-white hover:text-primary text-2xl"><i class="fas fa-step-forward"></i></button>
            </div>
            <div class="w-full bg-white/20 h-1.5 rounded-full overflow-hidden mb-6 cursor-pointer" onclick="seekAudio(event)">
                <div id="overlay-progress" class="bg-primary h-full w-0 transition-all duration-100"></div>
            </div>
            <div class="border-t border-white/20 pt-4">
                <h4 class="text-secondary font-bold mb-3">Up Next</h4>
                <div id="overlay-playlist" class="max-h-40 overflow-y-auto space-y-2 pr-2"></div>
            </div>
        </div>
    </div>

    <!-- WELCOME POPUP -->
    <div id="welcome-popup" class="hide">
        <span>Listen bhajans while navigating !</span>
        <button onclick="this.parentElement.remove()" class="text-white hover:text-black"><i class="fas fa-times"></i></button>
    </div>

    <!-- GLOBAL AUDIO PLAYER UI -->
    <div id="global-player-ui" class="glass-panel p-2 rounded-full hidden items-center gap-3 pr-4 shadow-lg border-white/40 bg-black/60 backdrop-blur-md text-white" onclick="handlePlayerClick()">
        <button onclick="togglePlayerCollapse(event)" class="player-minimize-btn text-white/70 hover:text-white mr-1 text-xs hide"><i class="fas fa-compress-arrows-alt"></i></button>
        <div class="player-art-container relative w-8 h-8 rounded-full overflow-hidden border border-primary bg-black flex-shrink-0 cursor-pointer">
            <img src="https://images.unsplash.com/photo-1582236894372-a4f65342898c?q=80" class="w-full h-full object-cover animate-spin-slow" id="player-art">
        </div>
        <div class="player-info flex flex-col w-24 overflow-hidden cursor-pointer">
            <span id="player-title" class="text-[10px] font-bold truncate text-secondary">Loading...</span>
            <div class="w-full h-1 bg-white/20 rounded-full mt-0.5 overflow-hidden cursor-pointer" onclick="seekAudio(event)">
                <div id="player-progress" class="h-full bg-primary w-0 transition-all duration-100"></div>
            </div>
        </div>
        <div class="player-controls flex items-center gap-2 text-xs">
            <button onclick="audioPrev(event)" class="hover:text-primary transition"><i class="fas fa-step-backward"></i></button>
            <button onclick="audioToggle(event)" id="play-pause-btn" class="w-6 h-6 rounded-full bg-white text-primary flex items-center justify-center hover:scale-110 transition"><i class="fas fa-play pl-0.5"></i></button>
            <button onclick="audioNext(event)" class="hover:text-primary transition"><i class="fas fa-step-forward"></i></button>
        </div>
    </div>

    <div id="aarti-cursor" class="hide">ü™î</div>
    <div id="toast" class="toast flex items-center gap-3"><i class="fas fa-info-circle"></i><span id="toast-msg">Notification</span></div>
    <button id="scroll-top-btn" onclick="scrollToTop()" class="fixed bottom-6 right-6 z-50 bg-primary text-white w-12 h-12 rounded-full shadow-lg hide transition-transform hover:scale-110 flex items-center justify-center border-2 border-white/50"><i class="fas fa-arrow-up"></i></button>

    <!-- NEW FEATURE: JAPA MALA MODAL -->
    <div id="mala-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-sm p-8 rounded-full aspect-square relative bg-white/95 dark:bg-slate-900/95 shadow-2xl flex flex-col items-center justify-center border-4 border-secondary/50">
            <button onclick="toggleJapaMala()" class="absolute top-8 right-8 text-red-500 text-2xl"><i class="fas fa-times"></i></button>
            <h2 class="text-xl font-bold text-primary mb-2">Japa Mala</h2>
            <div class="mala-bead w-32 h-32 rounded-full bg-gradient-to-br from-orange-400 to-red-600 shadow-inner flex items-center justify-center cursor-pointer mb-4 border-4 border-white select-none" onclick="countMala()">
                <span id="mala-count" class="text-5xl font-bold text-white drop-shadow-md">0</span>
            </div>
            <p class="text-sm opacity-70 text-center mb-4">Tap the bead to chant.<br>Target: 108</p>
            <button onclick="resetMala()" class="text-xs text-gray-500 hover:text-red-500"><i class="fas fa-redo"></i> Reset</button>
        </div>
    </div>

    <!-- NEW FEATURE: DIVINE ORACLE MODAL -->
    <div id="oracle-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-md p-8 rounded-2xl relative bg-white/95 dark:bg-slate-900/95 shadow-2xl text-center border border-secondary">
            <button onclick="toggleOracle()" class="absolute top-4 right-4 text-red-500 text-2xl"><i class="fas fa-times"></i></button>
            <i class="fas fa-om text-5xl text-primary mb-4 animate-pulse"></i>
            <h2 class="text-2xl font-bold text-secondary mb-6">Prabhu Sandesh</h2>
            <p id="oracle-msg" class="text-xl font-heading leading-relaxed mb-8 min-h-[100px] flex items-center justify-center italic">"Wait for the message..."</p>
            <button onclick="askOracle()" class="bg-primary text-white px-6 py-2 rounded-full hover:bg-orange-700 transition">Receive Another Message</button>
        </div>
    </div>

    <!-- CONTACT & SANKALP MODALS -->
    <div id="contact-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-md p-8 rounded-2xl relative bg-white/90 dark:bg-slate-900/90 shadow-2xl">
            <button onclick="toggleContactModal()" class="absolute top-4 right-4 text-red-500 text-2xl"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold text-primary mb-4" data-key="contactTitle">‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•á‡§ú‡•á‡§Ç</h2>
            <form onsubmit="handleContactSubmit(event)" class="space-y-4">
                <input type="text" placeholder="Name" required class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white">
                <input type="text" placeholder="Email/Phone" required class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white">
                <textarea placeholder="Message" required class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white" rows="3"></textarea>
                <button type="submit" class="w-full bg-primary text-white font-bold py-2 rounded hover:bg-orange-700 transition">Send Message</button>
            </form>
        </div>
    </div>

    <div id="sankalp-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-lg p-8 rounded-2xl relative bg-white/95 dark:bg-slate-900/95 shadow-2xl">
            <button onclick="toggleSankalp()" class="absolute top-4 right-4 text-red-500 text-2xl"><i class="fas fa-times"></i></button>
            <h2 class="text-2xl font-bold text-primary mb-2">Digital Sankalp</h2>
            <p class="text-sm opacity-70 mb-4">Post your prayer to the Lord.</p>
            <form onsubmit="handleSankalpSubmit(event)" class="space-y-3 mb-6">
                <input type="text" id="sankalp-name" placeholder="Your Name" required class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white">
                <input type="text" id="sankalp-gotra" placeholder="Gotra (Optional)" class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white">
                <textarea id="sankalp-wish" placeholder="Your Wish/Prayer..." required class="w-full p-2 rounded border border-gray-300 dark:bg-black/40 text-black dark:text-white" rows="2"></textarea>
                <button type="submit" class="w-full bg-secondary text-black font-bold py-2 rounded hover:bg-yellow-400 transition">Post Sankalp</button>
            </form>
            <div class="border-t border-gray-400 pt-4">
                <h3 class="font-bold mb-2">Recent Prayers:</h3>
                <div class="h-32 overflow-hidden relative bg-black/5 rounded p-2"><div id="sankalp-marquee" class="absolute w-full space-y-2 transition-transform duration-1000" style="top: 0;"></div></div>
            </div>
        </div>
    </div>

    <!-- SEARCH & SETTINGS MODALS -->
    <div id="search-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-lg p-6 rounded-2xl relative bg-white/90 dark:bg-slate-900/90 mt-[-10vh]">
            <div class="flex items-center border-b border-gray-400 pb-2 mb-4">
                <i class="fas fa-search text-gray-500 mr-3"></i>
                <input type="text" id="search-input" onkeyup="performSearch()" placeholder="Search site..." class="flex-grow bg-transparent outline-none text-lg text-black dark:text-white">
                <button onclick="toggleSearch()" class="text-red-500"><i class="fas fa-times"></i></button>
            </div>
            <div id="search-results" class="max-h-60 overflow-y-auto space-y-2"><p class="text-center opacity-50 text-sm py-4">Start typing to search...</p></div>
        </div>
    </div>

    <div id="image-preview-modal" class="fullscreen-modal hide" onclick="closeImagePreview()">
        <img id="preview-img-target" src="" class="max-h-[90vh] max-w-[90vw] object-contain shadow-2xl border-4 border-white rounded-lg">
        <button class="absolute top-5 right-5 text-white text-4xl hover:text-red-500"><i class="fas fa-times"></i></button>
    </div>

    <div id="settings-modal" class="modal-overlay hide animate-fade-in">
        <div class="glass-panel w-full max-w-lg max-h-[90vh] overflow-y-auto rounded-2xl p-8 relative bg-white/10 dark:bg-black/40 text-left">
            <button onclick="toggleSettings()" class="absolute top-4 right-4 text-red-500 hover:text-red-700 transition"><i class="fas fa-times text-2xl"></i></button>
            <h2 class="text-2xl font-bold text-primary mb-6 border-b border-gray-400 pb-2" data-key="settingsTitle">Accessibility & Settings</h2>
            <div class="mb-6"><h3 class="font-bold mb-2" data-key="labelLang">Language / ‡§≠‡§æ‡§∑‡§æ</h3><select id="lang-select" onchange="changeLanguage(this.value)" class="w-full p-2 rounded bg-white/50 border border-gray-400 dark:bg-black/50 dark:border-gray-600 text-black dark:text-white"><option value="hi">Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option><option value="en">English</option></select></div>
            <div class="mb-6"><h3 class="font-bold mb-2" data-key="labelNavStyle">Navigation Style</h3><div class="flex gap-2 text-sm"><button onclick="setNavStyle('top')" class="flex-1 p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-primary hover:text-white transition" data-key="navTop">Top</button><button onclick="setNavStyle('side')" class="flex-1 p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-primary hover:text-white transition" data-key="navSide">Side</button><button onclick="setNavStyle('bottom')" class="flex-1 p-2 bg-gray-200 dark:bg-gray-700 rounded hover:bg-primary hover:text-white transition" data-key="navBottom">Bottom (Dock)</button></div></div>
            <div class="mb-6"><h3 class="font-bold mb-2" data-key="labelTheme">Theme Colors</h3><div class="grid grid-cols-5 gap-3" id="theme-grid"></div></div>
            <div class="mb-6 space-y-3"><h3 class="font-bold" data-key="labelFonts">Fonts</h3><div><label class="text-xs opacity-70" data-key="labelHeadFont">Heading Font</label><select onchange="updateCustomFont('heading', this.value)" class="font-select w-full p-2 rounded bg-white/50 border border-gray-400 dark:bg-black/50 text-black dark:text-white"></select></div><div><label class="text-xs opacity-70" data-key="labelBodyFont">Body Font</label><select onchange="updateCustomFont('body', this.value)" class="font-select w-full p-2 rounded bg-white/50 border border-gray-400 dark:bg-black/50 text-black dark:text-white"></select></div></div>
            <div class="mb-6"><h3 class="font-bold mb-2" data-key="labelTypo">Typography & Contrast</h3><div class="flex items-center gap-4 mb-3"><button onclick="adjustFontSize(-1)" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded"><i class="fas fa-minus"></i> A</button><span class="font-bold" data-key="labelSize">Size</span><button onclick="adjustFontSize(1)" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded"><i class="fas fa-plus"></i> A</button></div><div class="flex items-center justify-between mt-4 p-3 bg-gray-100 dark:bg-gray-800 rounded"><span class="font-bold" data-key="labelDark">Dark Mode</span><button id="dark-mode-btn" onclick="toggleDarkMode()" class="text-2xl text-gray-700 dark:text-yellow-400 hover:scale-110 transition"><i class="fas fa-moon"></i></button></div></div>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div id="main-layout" class="flex flex-col min-h-screen transition-all duration-300">
        <!-- TOP NAV -->
        <nav id="top-nav" class="glass-panel sticky top-0 z-40 px-6 py-3 flex justify-between items-center transition-all shadow-md">
            <div class="flex items-center gap-3 w-full lg:w-auto" id="top-nav-left">
                <button id="top-nav-search-trigger" onclick="toggleSearch()" class="hide text-primary text-xl hover:scale-110 transition"><i class="fas fa-search"></i></button>
                <div id="desktop-bottom-search-container" class="hide relative w-64"><input type="text" onkeyup="performSearch(this)" placeholder="Search..." class="w-full pl-3 pr-8 py-1 rounded-full bg-black/10 border border-gray-400 outline-none text-sm"><i class="fas fa-search absolute right-3 top-1.5 text-gray-500"></i></div>
                <div id="top-nav-icon-container"><i class="fas fa-om text-3xl text-primary animate-pulse" id="top-nav-icon"></i></div>
                <div id="top-nav-title-group" class="transition-all duration-300"><h1 class="text-xl font-bold leading-none text-primary" data-key="templeName" id="nav-title">‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§¨‡§°‡§º‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§π‡§∏‡§æ‡§Æ‡§™‡•Å‡§∞</h1></div>
                <button id="mobile-burger-btn" class="hide text-2xl text-primary z-50 transition-transform burger-icon absolute right-6 lg:static" onclick="toggleSideNav()"><i class="fas fa-bars"></i></button>
            </div>
            <div class="hidden lg:flex gap-6 font-bold text-sm uppercase tracking-wide items-center" id="top-menu-items"></div>
            <div class="flex items-center gap-4" id="top-nav-right">
                <button id="desktop-side-burger" class="hide text-2xl text-primary z-50 transition-transform burger-icon ml-3 hover:scale-110" onclick="toggleSideNav()"><i class="fas fa-bars"></i></button>
                <div id="desktop-bottom-player-container"></div>
                <button onclick="shareApp()" class="hidden lg:block text-primary hover:scale-110 transition" title="Share App"><i class="fas fa-share-alt text-xl"></i></button>
                <button id="top-nav-search-btn" onclick="toggleSearch()" class="hidden lg:block text-primary hover:scale-110 transition" title="Search"><i class="fas fa-search text-xl"></i></button>
                <button id="top-nav-settings-btn" onclick="toggleSettings()" class="hidden lg:flex items-center gap-2 bg-primary/20 hover:bg-primary/40 px-4 py-2 rounded-full transition border border-primary text-primary font-bold" title="Settings"><i class="fas fa-cog"></i> <span>Settings</span></button>
                <button id="music-disk-trigger" onclick="togglePlayerOverlay()" class="w-10 h-10 rounded-full border-2 border-primary bg-black overflow-hidden animate-spin-slow shadow-lg hover:scale-110 transition"><img src="https://images.unsplash.com/photo-1582236894372-a4f65342898c?q=80" class="w-full h-full object-cover opacity-80 animate-spin-slow"></button>
                <button id="top-nav-mobile-menu-btn" class="lg:hidden text-2xl text-primary" onclick="toggleMobileMenu()"><i class="fas fa-bars"></i></button>
            </div>
        </nav>

        <!-- TICKER -->
        <div id="announcement-bar" class="ticker-wrap hide" data-feature="ticker"><div class="ticker" id="announcement-text">üéâ Upcoming: Narsimha Jayanti Mela preparations are underway! üôè</div></div>

        <!-- SIDE NAV -->
        <nav id="side-nav" style="width: var(--side-nav-width);" class="fixed left-0 top-0 h-full glass-panel z-50 transform -translate-x-full transition-transform duration-300 flex flex-col p-6 hide shadow-2xl bg-white dark:bg-neutral-900 overflow-y-auto">
            <div id="side-nav-resizer"></div>
            <div class="flex items-center gap-3 mb-6 border-b border-gray-400 pb-4"><i class="fas fa-om text-3xl text-primary"></i><h1 class="text-lg font-bold text-primary leading-tight" data-key="templeNameShort">‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§Æ‡§Ç‡§¶‡§ø‡§∞</h1></div>
            <div id="side-nav-search-container" class="mb-4 hide"><div class="relative"><i class="fas fa-search absolute left-3 top-3 text-gray-400"></i><input type="text" onkeyup="performSearch(this)" placeholder="Search..." class="w-full pl-10 p-2 rounded bg-gray-100 dark:bg-gray-800 border border-transparent focus:border-primary outline-none"></div></div>
            <div class="flex flex-col gap-4" id="side-menu-items"></div>
            <div class="mt-auto border-t pt-4 space-y-3"><div id="side-nav-player-container"></div><div class="w-full h-[1px] bg-gray-300 dark:bg-gray-700 my-2"></div><button onclick="toggleSettings()" class="flex items-center gap-3 w-full text-left hover:text-primary transition font-bold"><i class="fas fa-universal-access"></i> <span data-key="settingsBtn">Settings</span></button></div>
        </nav>

        <!-- BOTTOM NAV -->
        <nav id="bottom-nav" class="fixed z-50 flex justify-between items-center hide dock-nav glass-panel bg-white/90 dark:bg-black/80 backdrop-blur-xl">
            <div id="dock-items-container" class="flex justify-around flex-grow gap-2 sm:gap-4"></div>
            <button onclick="toggleSettings()" class="dock-item ml-2 sm:ml-4 text-primary bg-primary/10 p-2 sm:p-3 rounded-xl hover:bg-primary hover:text-white transition"><i class="fas fa-cog text-xl"></i></button>
        </nav>

        <!-- MOBILE MENU -->
        <div id="mobile-menu" class="fixed inset-0 glass-panel z-50 -translate-y-full flex flex-col items-center justify-center space-y-6 text-text font-bold text-xl bg-white/80 dark:bg-black/80 backdrop-blur-lg">
            <button onclick="toggleMobileMenu()" class="absolute top-6 right-6 text-3xl hover:text-red-500 hamburger-to-x"><i class="fas fa-times"></i></button>
            <div id="mobile-menu-links" class="flex flex-col text-center gap-6"></div>
            <div id="mobile-menu-player-container" class="mt-4 p-4 border border-white/20 rounded-xl bg-white/5"><div class="flex items-center gap-4 cursor-pointer" onclick="togglePlayerOverlay(); toggleMobileMenu();"><div class="w-10 h-10 rounded-full border border-primary bg-black overflow-hidden animate-spin-slow"><img src="https://images.unsplash.com/photo-1582236894372-a4f65342898c?q=80" class="w-full h-full object-cover opacity-80 animate-spin-slow"></div><span class="text-sm font-normal opacity-80">Open Music Player</span></div></div>
            <div class="flex gap-4 mt-8"><button onclick="toggleSearch(); toggleMobileMenu();" class="px-6 py-2 border border-current rounded-full hover:bg-primary/20"><i class="fas fa-search mr-2"></i> Search</button><button onclick="toggleSettings(); toggleMobileMenu();" class="px-6 py-2 border border-current rounded-full hover:bg-primary/20"><i class="fas fa-universal-access mr-2"></i> <span data-key="settingsBtn">Settings</span></button></div>
        </div>

        <!-- CONTENT -->
        <main id="content-area" class="flex-grow transition-all duration-300" onclick="closeSideNavIfMobile()">
            
            <!-- HOME -->
            <section id="view-home" class="view-section animate-fade-in">
                <div class="relative min-h-screen flex items-center justify-center overflow-hidden pb-12">
                    <div class="absolute inset-0 z-0"><img id="hero-bg" src="https://images.unsplash.com/photo-1621827979802-6d779e19391d?q=80&w=2070" class="w-full h-full object-cover transition-transform duration-[20s] hover:scale-110"><div class="absolute inset-0 bg-gradient-to-b from-primary/20 to-transparent"></div><div class="absolute inset-0 bg-gradient-to-t from-bg via-transparent to-transparent"></div></div>
                    <div class="relative z-10 container mx-auto px-4 text-center pt-4">
                        <div class="flex justify-center items-center gap-2 mb-4"><div class="glass-panel inline-block px-4 py-2 rounded-full text-sm font-bold text-secondary border border-secondary/50 backdrop-blur-md" data-feature="panchang">üìÖ <span id="panchang-text">Loading...</span></div><div id="live-darshan-badge" class="glass-panel inline-block px-4 py-2 rounded-full text-sm font-bold border border-white/30 backdrop-blur-md transition-colors duration-500"><i class="fas fa-circle text-[10px] mr-1"></i> <span id="darshan-status-text">Checking...</span></div></div>
                        <div class="mb-4"><p id="shloka-display" class="sanskrit text-lg md:text-xl font-bold tracking-wider drop-shadow-md bg-black/40 inline-block px-4 py-1 rounded transition-opacity duration-1000">Loading Shloka...</p></div>
                        <div class="relative mx-auto w-fit"><div class="w-48 h-48 md:w-64 md:h-64 rounded-full border-4 border-secondary overflow-hidden mx-auto shadow-2xl glass-panel flex items-center justify-center mb-6 ring-4 ring-primary/30 relative group z-10" id="idol-container"><img id="main-idol-img" src="https://content3.jdmagicbox.com/v2/comp/sikar/q3/9999p1572.1572.190911003614.r5q3/catalogue/narsingh-ji-mandir-hasampur-sikar-temples-le5pjvyy3r.jpg" class="w-full h-full object-cover"></div><div class="absolute bottom-1 -right-4 md:-right-1 flex gap-2 z-20"><button onclick="offerFlowers()" class="bg-secondary text-primary font-bold p-3 scale-90 rounded-full shadow-lg hover:scale-95 transition border-2 border-white" title="Offer Flowers"><i class="fas fa-spa text-xl"></i></button></div><div id="flower-container"></div></div>
                        <h2 id="main-heading-display" class="text-4xl md:text-7xl font-bold text-white mb-4 drop-shadow-[0_4px_4px_rgba(0,0,0,0.8)]" data-key="mainHeading">‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π</h2>
                        <p class="text-xl md:text-2xl text-secondary mb-8 font-light drop-shadow-md bg-black/30 inline-block px-4 py-1 rounded-full" data-key="subHeading">‡§π‡§∏‡§æ‡§Æ‡§™‡•Å‡§∞ ‡§ß‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à</p>
                        <div class="glass-panel rounded-xl p-6 max-w-2xl mx-auto border-t-4 border-secondary transform hover:scale-105 transition-transform bg-black/40 backdrop-blur-md"><h3 class="text-2xl font-bold text-secondary mb-2"><i class="fas fa-fire-alt mr-2"></i> <span data-key="melaTitle">‡§Æ‡§π‡§æ ‡§Æ‡•á‡§≤‡§æ 2026</span></h3><p class="text-white mb-4 font-bold tracking-wider" id="mela-date-display">30 April 2026</p><div class="grid grid-cols-4 gap-4 text-center text-white"><div><span id="days" class="text-3xl font-bold block text-secondary">00</span><span class="text-xs uppercase" data-key="unitDays">‡§¶‡§ø‡§®</span></div><div><span id="hours" class="text-3xl font-bold block text-secondary">00</span><span class="text-xs uppercase" data-key="unitHrs">‡§ò‡§Ç‡§ü‡•á</span></div><div><span id="minutes" class="text-3xl font-bold block text-secondary">00</span><span class="text-xs uppercase" data-key="unitMins">‡§Æ‡§ø‡§®‡§ü</span></div><div><span id="seconds" class="text-3xl font-bold block text-secondary">00</span><span class="text-xs uppercase" data-key="unitSecs">‡§∏‡•á‡§ï‡§Ç‡§°</span></div></div></div>
                    </div>
                </div>
                <div class="container mx-auto px-4 py-16"><div class="glass-panel p-8 rounded-2xl shadow-xl max-w-6xl mx-auto relative overflow-hidden"><div class="absolute top-0 left-0 w-full h-2 bg-primary"></div><h3 class="text-3xl font-bold text-center text-primary mb-8"><i class="far fa-clock mr-3"></i> <span data-key="templeScheduleTitle">‡§¶‡§∞‡•ç‡§∂‡§® ‡§∏‡§Æ‡§Ø</span></h3><div class="grid md:grid-cols-3 gap-8 divide-y md:divide-y-0 md:divide-x divide-gray-300 dark:divide-gray-600"><div class="text-center px-4 py-4 md:py-0"><div class="text-4xl text-yellow-500 mb-2"><i class="fas fa-sun"></i></div><h4 class="text-xl font-bold text-secondary mb-4" data-key="timingMorning">‡§™‡•ç‡§∞‡§æ‡§§‡§É</h4><div class="space-y-2 text-sm md:text-base"><p class="flex justify-between"><span class="opacity-70" data-key="labelOpen">‡§ñ‡•Å‡§≤‡§®‡§æ:</span> <span class="font-bold" id="time-morning-open">5:00 AM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelAarti">‡§Ü‡§∞‡§§‡•Ä:</span> <span class="font-bold" id="time-morning-aarti">6:00 AM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelClose">‡§¨‡§Ç‡§¶:</span> <span class="font-bold" id="time-morning-close">12:00 PM</span></p></div></div><div class="text-center px-4 py-4 md:py-0"><div class="text-4xl text-orange-500 mb-2"><i class="fas fa-cloud-sun"></i></div><h4 class="text-xl font-bold text-secondary mb-4" data-key="timingMidday">‡§∞‡§æ‡§ú‡§≠‡•ã‡§ó</h4><div class="space-y-2 text-sm md:text-base"><p class="flex justify-between"><span class="opacity-70" data-key="labelOpen">‡§ñ‡•Å‡§≤‡§®‡§æ:</span> <span class="font-bold" id="time-mid-open">12:30 PM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelBhog">‡§≠‡•ã‡§ó:</span> <span class="font-bold" id="time-mid-aarti">1:00 PM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelClose">‡§¨‡§Ç‡§¶:</span> <span class="font-bold" id="time-mid-close">3:00 PM</span></p></div></div><div class="text-center px-4 py-4 md:py-0"><div class="text-4xl text-blue-400 mb-2"><i class="fas fa-moon"></i></div><h4 class="text-xl font-bold text-secondary mb-4" data-key="timingEvening">‡§∏‡§æ‡§Ø‡§Ç</h4><div class="space-y-2 text-sm md:text-base"><p class="flex justify-between"><span class="opacity-70" data-key="labelOpen">‡§ñ‡•Å‡§≤‡§®‡§æ:</span> <span class="font-bold" id="time-evening-open">4:00 PM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelAarti">‡§Ü‡§∞‡§§‡•Ä:</span> <span class="font-bold" id="time-evening-aarti">7:00 PM</span></p><p class="flex justify-between"><span class="opacity-70" data-key="labelClose">‡§¨‡§Ç‡§¶:</span> <span class="font-bold" id="time-evening-close">9:00 PM</span></p></div></div></div><div class="text-center mt-8 pt-6 border-t border-gray-300 dark:border-gray-600 opacity-75 text-sm"><i class="fas fa-info-circle"></i> <span data-key="timingNote">‡§§‡•ç‡§Ø‡•ã‡§π‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§¶‡•å‡§∞‡§æ‡§® ‡§∏‡§Æ‡§Ø ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§</span></div></div></div>
            </section>

            <!-- ABOUT -->
            <section id="view-about" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="text-center mb-10"><p class="sanskrit text-lg mb-4">‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§®‡§∞‡§∏‡§ø‡§Ç‡§π‡§æ‡§Ø ‡§™‡•ç‡§∞‡§π‡•ç‡§≤‡§æ‡§¶‡§æ‡§π‡•ç‡§≤‡§æ‡§¶ ‡§¶‡§æ‡§Ø‡§ø‡§®‡•á‡•§<br>‡§π‡§ø‡§∞‡§£‡•ç‡§Ø‡§ï‡§∂‡§ø‡§™‡•ã‡§∞‡•ç‡§µ‡§ï‡•ç‡§∑‡§É ‡§∂‡§ø‡§≤‡§æ‡§ü‡§ô‡•ç‡§ï ‡§®‡§ñ‡§æ‡§≤‡§Ø‡•á‡••</p><h2 class="text-4xl font-bold text-primary border-b-2 border-secondary inline-block pb-2" data-key="aboutTitle">‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§î‡§∞ ‡§Æ‡§π‡§§‡•ç‡§µ</h2></div>
                <div class="glass-panel p-8 rounded-xl shadow-lg max-w-4xl mx-auto"><div class="flex flex-col md:flex-row gap-8 items-center"><img src="https://images.unsplash.com/photo-1561361058-c24ce813d943?q=80" class="w-full md:w-1/3 rounded-lg shadow-md hover:scale-105 transition"><div><p class="text-lg leading-relaxed mb-4 text-justify" data-key="historyText1">‡§π‡§∏‡§æ‡§Æ‡§™‡•Å‡§∞ ‡§ï‡§æ ‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§¨‡§°‡§º‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§è‡§ï ‡§Ö‡§§‡•ç‡§Ø‡§Ç‡§§ ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§î‡§∞ ‡§™‡§µ‡§ø‡§§‡•ç‡§∞ ‡§∏‡•ç‡§•‡§≤ ‡§π‡•à‡•§ ‡§Æ‡§æ‡§®‡•ç‡§Ø‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§Ö‡§®‡•Å‡§∏‡§æ‡§∞, ‡§Ø‡§π‡§æ‡§Å ‡§≠‡§ó‡§µ‡§æ‡§® ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§∏‡•ç‡§µ‡§Ø‡§Ç‡§≠‡•Ç ‡§∞‡•Ç‡§™ ‡§Æ‡•á‡§Ç ‡§µ‡§ø‡§∞‡§æ‡§ú‡§Æ‡§æ‡§® ‡§π‡•à‡§Ç‡•§</p><p class="text-lg leading-relaxed text-justify" data-key="historyText2">‡§π‡§∞ ‡§∏‡§æ‡§≤ ‡§µ‡•à‡§∂‡§æ‡§ñ ‡§∂‡•Å‡§ï‡•ç‡§≤ ‡§™‡§ï‡•ç‡§∑ ‡§Æ‡•á‡§Ç ‡§Ø‡§π‡§æ‡§Å ‡§≠‡§µ‡•ç‡§Ø ‡§Æ‡•á‡§≤‡•á ‡§ï‡§æ ‡§Ü‡§Ø‡•ã‡§ú‡§® ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§Æ‡•á‡§Ç ‡§¶‡•Ç‡§∞-‡§¶‡•Ç‡§∞ ‡§∏‡•á ‡§∂‡•ç‡§∞‡§¶‡•ç‡§ß‡§æ‡§≤‡•Å ‡§Ö‡§™‡§®‡•Ä ‡§Æ‡§®‡•ã‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Ç ‡§≤‡•á‡§ï‡§∞ ‡§Ü‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Æ‡§Ç‡§¶‡§ø‡§∞ ‡§ï‡•Ä ‡§µ‡§æ‡§∏‡•ç‡§§‡•Å‡§ï‡§≤‡§æ ‡§™‡•ç‡§∞‡§æ‡§ö‡•Ä‡§® ‡§≠‡§æ‡§∞‡§§‡•Ä‡§Ø ‡§∏‡§Ç‡§∏‡•ç‡§ï‡•É‡§§‡§ø ‡§ï‡§æ ‡§Ö‡§¶‡•ç‡§µ‡§ø‡§§‡•Ä‡§Ø ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§π‡•à‡•§</p></div></div></div>
            </section>

            <!-- GALLERY -->
            <section id="view-gallery" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="text-center mb-4"><p class="sanskrit text-sm">‡§§‡§µ ‡§ï‡§∞‡§ï‡§Æ‡§≤‡§µ‡§∞‡•á ‡§®‡§ñ‡§Æ‡•ç ‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§‡§∂‡•É‡§ô‡•ç‡§ó‡§Æ‡•ç ‡•§ ‡§¶‡§≤‡§ø‡§§‡§π‡§ø‡§∞‡§£‡•ç‡§Ø‡§ï‡§∂‡§ø‡§™‡•Å‡§§‡§®‡•Å‡§≠‡•É‡§ô‡•ç‡§ó‡§Æ‡•ç ‡••</p></div>
                <div class="flex flex-col sm:flex-row justify-between items-center mb-10 gap-4"><h2 class="text-4xl font-bold text-primary" data-key="galleryTitle">‡§¶‡§∞‡•ç‡§∂‡§® ‡§ó‡•à‡§≤‡§∞‡•Ä</h2><div class="flex gap-2"><label class="glass-panel px-4 py-2 cursor-pointer hover:bg-white/20 rounded transition flex items-center gap-2" data-feature="selfie"><i class="fas fa-camera-retro text-secondary"></i> <span>Selfie Frame</span><input type="file" accept="image/*" class="hidden" onchange="createSelfie(event)"></label><label class="glass-panel px-4 py-2 cursor-pointer hover:bg-white/20 rounded transition flex items-center gap-2"><i class="fas fa-upload text-primary"></i> <span data-key="uploadPhoto">‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</span><input type="file" accept="image/*" class="hidden" onchange="addToGallery(event)"></label></div></div>
                <div id="gallery-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
                    <div class="gallery-item rounded-xl overflow-hidden shadow-lg h-64 group relative border border-white/20 cursor-pointer" onclick="openImagePreview(this)"><img src="https://content3.jdmagicbox.com/v2/comp/sikar/q3/9999p1572.1572.190911003614.r5q3/catalogue/narsingh-ji-mandir-hasampur-sikar-temples-xsj3w5rrli.jpg" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"></div>
                    <div class="gallery-item rounded-xl overflow-hidden shadow-lg h-64 group relative border border-white/20 cursor-pointer" onclick="openImagePreview(this)"><img src="https://scontent.fjai1-3.fna.fbcdn.net/v/t51.82787-15/587951883_17967382274988920_6614558592535786365_n.jpg?_nc_cat=103&ccb=1-7&_nc_sid=127cfc&_nc_ohc=GvxLczoJi3wQ7kNvwG4gDrG&_nc_oc=AdmoHOxBds9tmEOf8PMoOKMgzOrOjY41SeQdMgkNumK54emZ7ExDSUztZxd5gaUqXj9mAOPjFEf85f3sGkzGGBsq&_nc_zt=23&_nc_ht=scontent.fjai1-3.fna&_nc_gid=LlSbT4g79MNjH8dB3bESMg&oh=00_AfrtC0hymB9JoZHWulWMGOKTh0u3Su9bNnaM7K1UKd5bxQ&oe=696EAB15" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"></div>
                </div>
            </section>

            <!-- BHAJANS -->
            <section id="view-bhajans" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="text-center mb-12"><h2 class="text-4xl font-bold text-primary mb-4" data-key="navBhajans">‡§≠‡§ú‡§® ‡§î‡§∞ ‡§ó‡•ç‡§∞‡§Ç‡§•</h2><p class="text-xl opacity-80" data-key="subBhajanLibrary">‡§°‡§ø‡§ú‡§ø‡§ü‡§≤ ‡§≤‡§æ‡§á‡§¨‡•ç‡§∞‡•á‡§∞‡•Ä</p></div>
                <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6" id="bhajan-container">
                    <div class="glass-panel p-6 rounded-xl flex items-center gap-4 hover:bg-white/5 transition border border-orange-500/30 cursor-pointer" onclick="toggleJapaMala()"><div class="bg-gradient-to-r from-orange-500 to-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl shadow-lg"><i class="fas fa-ring"></i></div><div><h4 class="font-bold text-primary">Digital Japa Mala</h4><p class="text-xs opacity-70">Interactive ‚Ä¢ Meditation</p></div><button class="ml-auto text-secondary hover:scale-110 transition"><i class="fas fa-chevron-right"></i></button></div>
                    <div class="glass-panel p-6 rounded-xl flex items-center gap-4 hover:bg-white/5 transition"><div class="bg-primary text-white w-12 h-12 rounded-full flex items-center justify-center text-xl"><i class="fas fa-music"></i></div><div><h4 class="font-bold">Narasimha Kavacham</h4><p class="text-xs opacity-70">Audio ‚Ä¢ 15 mins</p></div><button onclick="playBhajan('Narasimha Kavacham')" class="ml-auto text-secondary hover:scale-110 transition"><i class="fas fa-play-circle text-3xl"></i></button></div>
                    <div class="glass-panel p-6 rounded-xl flex items-center gap-4 hover:bg-white/5 transition"><div class="bg-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl"><i class="fas fa-book-open"></i></div><div><h4 class="font-bold">Temple History PDF</h4><p class="text-xs opacity-70">Document ‚Ä¢ 2 MB</p></div><button class="ml-auto text-secondary hover:scale-110 transition"><i class="fas fa-download text-3xl"></i></button></div>
                </div>
            </section>

            <!-- CALENDAR -->
            <section id="view-calendar" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="text-center mb-10">
                    <h2 class="text-4xl font-bold text-primary mb-4" data-key="calendarTitle">‡§á‡§µ‡•á‡§Ç‡§ü ‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞</h2>
                    <p class="text-xl opacity-80" data-key="calendarSub">‡§Ü‡§ó‡§æ‡§Æ‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§Ø‡§ï‡•ç‡§∞‡§Æ - 2026</p>
                </div>
                <!-- Dynamic Calendar Container -->
                <div class="max-w-6xl mx-auto" id="calendar-events-container"></div>
            </section>

            <!-- LEELA -->
            <section id="view-leela" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="text-center mb-12"><h2 class="text-5xl font-bold text-primary mb-4" data-key="leelaTitle">‡§≤‡•Ä‡§≤‡§æ 2026</h2><p class="text-xl opacity-80" data-key="leelaSubtitle">‡§≠‡§µ‡•ç‡§Ø ‡§Æ‡•á‡§≤‡§æ ‡§Ü‡§Ø‡•ã‡§ú‡§® ‡§∏‡§Æ‡§ø‡§§‡§ø</p></div>
                <div id="leela-public" class="glass-panel p-8 rounded-xl max-w-3xl mx-auto text-center border border-red-200"><i class="fas fa-lock text-5xl text-red-500 mb-6"></i><h3 class="text-2xl font-bold mb-4" data-key="leelaLoginPrompt">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂</h3><p class="mb-6" data-key="leelaMsg">‡§ï‡•É‡§™‡§Ø‡§æ 5-‡§¶‡§ø‡§µ‡§∏‡•Ä‡§Ø ‡§Ø‡•ã‡§ú‡§®‡§æ ‡§¶‡•á‡§ñ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç‡•§</p><button onclick="switchView('view-login')" class="bg-primary text-white px-8 py-3 rounded-full hover:bg-orange-700 transition shadow-lg font-bold" data-key="btnGoLogin">‡§≤‡•â‡§ó‡§ø‡§® ‡§ï‡§∞‡•á‡§Ç</button></div>
                <div id="leela-member-dashboard" class="hide">
                    <div class="flex justify-between items-center mb-6"><div class="glass-panel px-4 py-2 rounded text-green-600 font-bold border-green-500 border"><span data-key="welcomeMember">‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à, ‡§∏‡§¶‡§∏‡•ç‡§Ø!</span></div><button onclick="handleLogout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition" data-key="btnLogout">‡§≤‡•â‡§ó‡§Ü‡§â‡§ü</button></div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8">
                        <div class="glass-panel p-4 rounded text-center border-t-4 border-red-500 transform hover:-translate-y-2 transition"><h4 class="font-bold text-lg">Day 1</h4><p class="text-sm font-bold text-primary">Ganesh Puja</p></div>
                        <div class="glass-panel p-4 rounded text-center border-t-4 border-orange-500 transform hover:-translate-y-2 transition"><h4 class="font-bold text-lg">Day 2</h4><p class="text-sm font-bold text-primary">Kalash Yatra</p></div>
                        <div class="glass-panel p-4 rounded text-center border-t-4 border-yellow-500 transform hover:-translate-y-2 transition"><h4 class="font-bold text-lg">Day 3</h4><p class="text-sm font-bold text-primary">Bhajan Sandhya</p></div>
                        <div class="glass-panel p-4 rounded text-center border-t-4 border-green-500 transform hover:-translate-y-2 transition"><h4 class="font-bold text-lg">Day 4</h4><p class="text-sm font-bold text-primary">Nagar Bhraman</p></div>
                        <div class="glass-panel p-4 rounded text-center border-t-4 border-purple-500 transform hover:-translate-y-2 transition"><h4 class="font-bold text-lg">Day 5</h4><p class="text-sm font-bold text-primary">Maha Abhishek</p></div>
                    </div>
                </div>
            </section>

            <!-- ADMIN DASHBOARD -->
            <section id="view-admin" class="view-section container mx-auto px-4 py-20 hide animate-fade-in">
                <div class="glass-panel p-8 rounded-xl shadow-2xl">
                    <div class="flex flex-col md:flex-row justify-between items-center mb-8 border-b border-gray-400 pb-4">
                        <h2 class="text-3xl font-bold text-primary">Admin Control Panel</h2>
                        <button onclick="handleLogout()" class="bg-red-500 text-white px-6 py-2 rounded-full font-bold">Logout</button>
                    </div>
                    <div class="grid lg:grid-cols-2 gap-8">
                        <div class="space-y-8">
                            
                            <!-- FEATURE MANAGER (NEW) -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg border-l-4 border-green-500">
                                <h3 class="text-xl font-bold mb-4 text-green-400"><i class="fas fa-toggle-on mr-2"></i> Feature Manager</h3>
                                <div class="grid grid-cols-2 gap-4" id="admin-feature-toggles"><!-- Populated by JS --></div>
                            </div>

                            <!-- EVENT MANAGER (UPDATED WITH BACKEND) -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg mt-6 border-l-4 border-primary">
                                <!-- GLOBAL DEFAULT IMAGE -->
                                <div class="glass-panel bg-white/10 p-6 rounded-lg mb-6 border-l-4 border-yellow-500">
                                    <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-cog mr-2"></i> Global Settings</h3>
                                    <label class="block text-sm font-bold mb-2">Default Event Image (Fallback)</label>
                                    <div class="flex gap-2 mb-2">
                                        <input type="text" id="admin-default-url" placeholder="Paste URL..." class="flex-grow p-2 rounded text-black bg-white/80">
                                        <input type="file" id="admin-default-file" accept="image/*" class="w-1/3 text-xs p-2 bg-white/20 rounded">
                                    </div>
                                    <button onclick="saveDefaultImage()" class="bg-yellow-600 text-white font-bold py-2 px-4 rounded hover:bg-yellow-700 transition w-full">Save Default Image</button>
                                    <p id="default-save-msg" class="text-xs text-green-400 mt-2 hidden">Saved Successfully!</p>
                                </div>

                                <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-calendar-plus mr-2"></i> Event Manager</h3>
                                <div class="space-y-3 mb-4">
                                    <input type="text" id="admin-event-title" placeholder="Event Title (e.g. Holi)" class="w-full p-2 rounded text-black bg-white/80">
                                    <input type="text" id="admin-event-location" placeholder="Location (e.g. Main Hall)" class="w-full p-2 rounded text-black bg-white/80">
                                    <input type="date" id="admin-event-date" class="w-full p-2 rounded text-black bg-white/80">
                                    <input type="text" id="admin-event-desc" placeholder="Description..." class="w-full p-2 rounded text-black bg-white/80">
                                    <input type="text" id="admin-event-image" placeholder="Option A: Paste Image URL" class="w-full p-2 rounded text-black bg-white/80">
                                    <div class="text-xs text-white/70 font-bold uppercase">OR Upload from Device:</div>
                                    <input type="file" id="admin-event-file" accept="image/*" class="w-full p-2 rounded bg-white/20 text-white text-sm">
                                    
                                    <div class="flex gap-2">
                                        <button id="btn-submit-event" onclick="handleFormSubmit()" class="flex-grow bg-primary text-white font-bold py-2 rounded hover:bg-orange-600 transition">Add Event to Calendar</button>
                                        <button id="btn-cancel-edit" onclick="exitEditMode()" class="hidden bg-gray-500 text-white font-bold py-2 px-4 rounded hover:bg-gray-600 transition">Cancel</button>
                                    </div>
                                </div>
                                <h4 class="font-bold text-sm mb-2 opacity-70">Manage Existing Events:</h4>
                                <div id="admin-event-list" class="max-h-48 overflow-y-auto pr-2"></div>
                                <button onclick="renderAdminEvents()" class="text-xs underline opacity-50 hover:opacity-100 mt-2">Refresh List</button>
                            </div>

                            <!-- Content & Media -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg">
                                <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-edit mr-2"></i> Content & Media</h3>
                                <div class="space-y-4">
                                    <div><label class="block text-sm font-bold mb-1">Heading</label><input type="text" id="admin-heading-input" class="w-full p-2 rounded text-black bg-white/80" placeholder="Jai Sri Narsimha"><button onclick="updateHeading()" class="mt-2 bg-primary text-white px-4 py-1 rounded text-sm hover:bg-orange-700">Update</button></div>
                                    <div><label class="block text-sm font-bold mb-1">Announcement</label><input type="text" id="admin-ticker-input" class="w-full p-2 rounded text-black bg-white/80" placeholder="Ticker Text..."><button onclick="updateTicker()" class="mt-2 bg-primary text-white px-4 py-1 rounded text-sm hover:bg-orange-700">Update Ticker</button></div>
                                    <div><label class="block text-sm font-bold mb-1">Mela Date</label><input type="date" id="admin-date-input" class="w-full p-2 rounded text-black bg-white/80"><button onclick="updateMelaDate()" class="mt-2 bg-primary text-white px-4 py-1 rounded text-sm hover:bg-orange-700">Update Date</button></div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Col -->
                        <div class="space-y-8">
                            <!-- Global Playlist Management -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg">
                                <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-music mr-2"></i> Playlist Manager</h3>
                                <div class="flex flex-col gap-2 mb-4">
                                    <label class="text-xs font-bold">Add from URL</label><input type="text" id="playlist-title" class="p-2 rounded text-black text-xs bg-white/80" placeholder="Track Title"><div class="flex gap-2"><input type="text" id="playlist-url" class="flex-grow p-2 rounded text-black text-xs bg-white/80" placeholder="MP3 URL"><button onclick="addToPlaylist()" class="bg-blue-600 text-white px-3 py-1 rounded text-xs hover:bg-blue-700">Add</button></div>
                                    <label class="text-xs font-bold mt-2">Or Upload Audio</label><div class="flex gap-2 items-center"><input type="file" id="playlist-file" accept="audio/*" class="w-full text-xs p-1 bg-white/80 rounded text-black"><button onclick="uploadAudio()" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700">Upload</button></div>
                                </div>
                                <div id="admin-playlist-list" class="max-h-32 overflow-y-auto space-y-2 text-xs"></div>
                            </div>

                            <!-- Settings & Uploads -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg">
                                <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-cog mr-2"></i> Settings & Uploads</h3>
                                <div class="space-y-4">
                                    <div><label class="block text-sm font-bold mb-1">Default Nav Style</label><select id="admin-default-nav" onchange="setDefaultNav(this.value)" class="w-full p-2 rounded text-black bg-white/80"><option value="top">Top Bar</option><option value="side">Side Bar</option><option value="bottom">Bottom Dock</option></select></div>
                                    <div><label class="block text-sm font-bold mb-1">Add Bhajan (Library)</label><div class="flex gap-2"><input type="text" id="bhajan-title" class="flex-grow p-2 rounded text-black text-xs bg-white/80" placeholder="Bhajan Title"><button onclick="addBhajan()" class="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-700"><i class="fas fa-plus"></i></button></div></div>
                                </div>
                            </div>

                            <!-- Typography & Styles -->
                            <div class="glass-panel bg-white/10 p-6 rounded-lg">
                                <h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-font mr-2"></i> Typography & Styles</h3>
                                <div class="grid grid-cols-2 gap-4">
                                    <div><label class="block text-xs font-bold mb-1">Shloka Color</label><input type="color" onchange="updateShlokaStyle('color', this.value)" class="w-full h-8 rounded cursor-pointer border border-white/30"></div>
                                    <div><label class="block text-xs font-bold mb-1">Shloka Font</label><select onchange="updateShlokaStyle('font', this.value)" class="font-select w-full p-1 text-black text-xs rounded bg-white/80"></select></div>
                                    <div><label class="block text-xs font-bold mb-1">Heading Font</label><select onchange="updateCustomFont('heading', this.value)" class="font-select w-full p-1 text-black text-xs rounded bg-white/80"></select></div>
                                    <div><label class="block text-xs font-bold mb-1">Body Font</label><select onchange="updateCustomFont('body', this.value)" class="font-select w-full p-1 text-black text-xs rounded bg-white/80"></select></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Theme -->
                    <div class="glass-panel bg-white/10 p-6 rounded-lg mt-8"><h3 class="text-xl font-bold mb-4 text-secondary"><i class="fas fa-palette mr-2"></i> Quick Theme Control</h3><div class="flex flex-wrap gap-4" id="admin-theme-controls"></div></div>
                </div>
            </section>

            <!-- LOGIN -->
            <section id="view-login" class="view-section container mx-auto px-4 py-20 hide animate-fade-in flex justify-center">
                <div class="glass-panel p-10 rounded-2xl w-full max-w-md relative overflow-hidden shadow-2xl border border-white/30">
                    <div class="text-center mb-6"><i class="fas fa-user-circle text-5xl text-primary mb-2"></i><h2 class="text-2xl font-bold" data-key="secureAccess">‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡•ç‡§∞‡§µ‡•á‡§∂</h2></div>
                    <form id="login-form" onsubmit="handleLogin(event)">
                        <div class="mb-4"><label class="block mb-2 text-sm font-bold opacity-80" data-key="labelUserType">User Type</label><select id="login-type" class="w-full p-3 rounded bg-white dark:bg-gray-800 border border-gray-300 text-black dark:text-white"><option value="member">Member</option><option value="admin">Admin</option></select></div>
                        <div class="mb-6"><label class="block mb-2 text-sm font-bold opacity-80" data-key="labelPassword">Password</label><input type="password" id="password" class="w-full p-3 rounded bg-white dark:bg-gray-800 border border-gray-300 text-black dark:text-white"></div>
                        <button type="submit" class="w-full bg-gradient-to-r from-primary to-orange-600 text-white font-bold py-3 rounded-lg" data-key="btnSignIn">Sign In</button>
                    </form>
                    <div id="login-msg" class="mt-4 text-center text-sm font-bold min-h-[20px]"></div>
                </div>
            </section>
        </main>

        <!-- FOOTER -->
        <footer class="bg-gray-900 text-white pt-16 pb-24 lg:pb-8 border-t-4 border-secondary mt-auto relative z-10 transition-all" id="main-footer">
            <div class="container mx-auto px-4">
                <div class="grid md:grid-cols-3 gap-8 mb-8">
                    <div><h3 class="font-bold text-xl text-secondary mb-4" data-key="footerContactTitle">‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç</h3><div id="footer-contact-info"><p class="mb-2"><i class="fas fa-map-marker-alt mr-2 text-primary"></i> <span data-key="templeNameShort">‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§Æ‡§Ç‡§¶‡§ø‡§∞</span></p><p class="mb-2 pl-6 text-gray-400">Hasampur Village, Rajasthan</p><p class="mt-4"><i class="fas fa-phone mr-2 text-primary"></i> +91 98765 43210</p></div></div>
                    <div class="text-center"><i class="fas fa-om text-4xl text-secondary mb-4 block"></i><p class="text-gray-400 italic">"Sarve Jana Sukhino Bhavantu"</p><div class="mt-6 inline-block bg-black/50 px-4 py-1 rounded text-xs font-mono text-green-400 border border-green-900" data-feature="visitor">Live Devotees: <span id="visitor-count">108</span></div></div>
                    <div><h3 class="font-bold text-xl text-secondary mb-4" data-key="footerLocationTitle">‡§∏‡•ç‡§•‡§æ‡§® ‡§î‡§∞ ‡§≤‡§ø‡§Ç‡§ï</h3><div class="rounded-lg overflow-hidden border border-gray-700 h-32 mb-4 bg-gray-800 relative"><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3700.651007515507!2d76.02246477554449!3d27.761745923089823!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x396d39db0417f251%3A0x1e678e4f685694d2!2sNarsingh%20Ji%20Bada%20Mandir!5e1!3m2!1sen!2sin!4v1768476864682!5m2!1sen!2sin" width="600" height="600" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div></div>
                </div>
                <div class="border-t border-gray-800 pt-8 text-center text-sm text-gray-500"><p>&copy; 2026 Sri Narsimha Temple Trust.</p></div>
            </div>
        </footer>
    </div>

    <!-- SCRIPT -->
    <script>
        // --- DATA & STATE ---
        const state = { lang: 'hi', navStyle: 'top', theme: 'saffron', user: null, activeView: 'view-home', melaDate: "2026-04-30T00:00:00", malaCount: 0, features: { pushpanjali: true, aarti: true, sankalp: true, panchang: true, selfie: true, visitor: true, ticker: true } };
        
        // --- ADMIN STATE ---
        let editingEventId = null; 
        let allAdminEvents = [];
        let globalDefaultImage = "https://images.unsplash.com/photo-1604537466158-719b1972feb8?q=80&w=1000";

        // --- TRANSLATIONS (Mini Version) ---
        const translations = {
            hi: { navHome: "‡§Æ‡•Å‡§ñ‡•ç‡§Ø ‡§™‡•É‡§∑‡•ç‡§†", navAbout: "‡§á‡§§‡§ø‡§π‡§æ‡§∏", navGallery: "‡§ó‡•à‡§≤‡§∞‡•Ä", navBhajans: "‡§≠‡§ú‡§®", navCalendar: "‡§ï‡•à‡§≤‡•á‡§Ç‡§°‡§∞", navLeela: "‡§≤‡•Ä‡§≤‡§æ", navLogin: "‡§≤‡•â‡§ó‡§ø‡§®", navAdmin: "‡§è‡§°‡§Æ‡§ø‡§®", templeName: "‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π ‡§¨‡§°‡§º‡§æ ‡§Æ‡§Ç‡§¶‡§ø‡§∞", mainHeading: "‡§ú‡§Ø ‡§∂‡•ç‡§∞‡•Ä ‡§®‡•É‡§∏‡§ø‡§Ç‡§π" },
            en: { navHome: "Home", navAbout: "History", navGallery: "Gallery", navBhajans: "Bhajans", navCalendar: "Calendar", navLeela: "Leela", navLogin: "Login", navAdmin: "Admin", templeName: "Sri Narsimha Temple", mainHeading: "Jai Sri Narsimha" }
        };
        const navItems = [
            { id: 'view-home', labelKey: 'navHome', icon: 'fa-place-of-worship' },
            { id: 'view-about', labelKey: 'navAbout', icon: 'fa-scroll' },
            { id: 'view-gallery', labelKey: 'navGallery', icon: 'fa-photo-film' },
            { id: 'view-bhajans', labelKey: 'navBhajans', icon: 'fa-music' },
            { id: 'view-calendar', labelKey: 'navCalendar', icon: 'fa-calendar-days' },
            { id: 'view-leela', labelKey: 'navLeela', icon: 'fa-wand-magic-sparkles' },
            { id: 'view-login', labelKey: 'navLogin', icon: 'fa-fingerprint' }
        ];

        const themes = [ { id: 'saffron', name: 'Saffron', colors: { p: '#ea580c', s: '#facc15', bg: '#fff7ed', t: '#1f2937' } }, { id: 'ocean', name: 'Ocean', colors: { p: '#0ea5e9', s: '#7dd3fc', bg: '#f0f9ff', t: '#1e293b' } }, { id: 'forest', name: 'Forest', colors: { p: '#15803d', s: '#86efac', bg: '#f0fdf4', t: '#14532d' } }, { id: 'royal', name: 'Royal', colors: { p: '#7e22ce', s: '#d8b4fe', bg: '#faf5ff', t: '#3b0764' } }, { id: 'cherry', name: 'Cherry', colors: { p: '#be123c', s: '#fda4af', bg: '#fff1f2', t: '#881337' } }, { id: 'midnight', name: 'Midnight', colors: { p: '#6366f1', s: '#818cf8', bg: '#1e293b', t: '#f8fafc' } }, { id: 'sunset', name: 'Sunset', colors: { p: '#f97316', s: '#fdba74', bg: '#fff7ed', t: '#431407' } }, { id: 'teal', name: 'Teal', colors: { p: '#0d9488', s: '#5eead4', bg: '#f0fdfa', t: '#134e4a' } }, { id: 'earth', name: 'Earth', colors: { p: '#854d0e', s: '#fde047', bg: '#fefce8', t: '#422006' } }, { id: 'slate', name: 'Slate', colors: { p: '#475569', s: '#94a3b8', bg: '#f8fafc', t: '#0f172a' } } ];
        const fonts = ['Noto Sans Devanagari', 'Poppins', 'Mukta', 'Baloo 2', 'Yatra One', 'Martel', 'Tiro Devanagari Hindi', 'Hind', 'Kalam', 'Gotu'];
        const shlokas = ["‡§â‡§ó‡•ç‡§∞‡§Ç ‡§µ‡•Ä‡§∞‡§Ç ‡§Æ‡§π‡§æ‡§µ‡§ø‡§∑‡•ç‡§£‡•Å‡§Ç ‡§ú‡•ç‡§µ‡§≤‡§®‡•ç‡§§‡§Ç ‡§∏‡§∞‡•ç‡§µ‡§§‡•ã‡§Æ‡•Å‡§ñ‡§Æ‡•ç ‡•§<br>‡§®‡•É‡§∏‡§ø‡§Ç‡§π‡§Ç ‡§≠‡•Ä‡§∑‡§£‡§Ç ‡§≠‡§¶‡•ç‡§∞‡§Ç ‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§Æ‡•É‡§§‡•ç‡§Ø‡•Å‡§Ç ‡§®‡§Æ‡§æ‡§Æ‡•ç‡§Ø‡§π‡§Æ‡•ç ‡••", "‡§®‡§Æ‡§∏‡•ç‡§§‡•á ‡§®‡§∞‡§∏‡§ø‡§Ç‡§π‡§æ‡§Ø ‡§™‡•ç‡§∞‡§π‡•ç‡§≤‡§æ‡§¶‡§æ‡§π‡•ç‡§≤‡§æ‡§¶ ‡§¶‡§æ‡§Ø‡§ø‡§®‡•á‡•§<br>‡§π‡§ø‡§∞‡§£‡•ç‡§Ø‡§ï‡§∂‡§ø‡§™‡•ã‡§∞‡•ç‡§µ‡§ï‡•ç‡§∑‡§É ‡§∂‡§ø‡§≤‡§æ‡§ü‡§ô‡•ç‡§ï ‡§®‡§ñ‡§æ‡§≤‡§Ø‡•á‡••", "‡§§‡§µ ‡§ï‡§∞‡§ï‡§Æ‡§≤‡§µ‡§∞‡•á ‡§®‡§ñ‡§Æ‡•ç ‡§Ö‡§¶‡•ç‡§≠‡•Å‡§§‡§∂‡•É‡§ô‡•ç‡§ó‡§Æ‡•ç ‡•§<br>‡§¶‡§≤‡§ø‡§§‡§π‡§ø‡§∞‡§£‡•ç‡§Ø‡§ï‡§∂‡§ø‡§™‡•Å‡§§‡§®‡•Å‡§≠‡•É‡§ô‡•ç‡§ó‡§Æ‡•ç ‡••", "‡§Ø‡§§‡•ã ‡§Ø‡§§‡•ã ‡§Ø‡§æ‡§Æ‡§ø ‡§§‡§§‡•ã ‡§®‡•É‡§∏‡§ø‡§Ç‡§π‡§É ‡•§<br>‡§¨‡§π‡§ø‡§∞‡•ç‡§®‡•É‡§∏‡§ø‡§Ç‡§π‡•ã ‡§π‡•É‡§¶‡§Ø‡•á ‡§®‡•É‡§∏‡§ø‡§Ç‡§π‡§É ‡••"];
        let currentShlokaIndex = 0;
        const oracleMessages = ["Faith is the only power that can destroy fear.", "Surrender your worries to Me, I shall protect you.", "Patience is the key to spiritual growth.", "Do your duty without attachment to the results."];
        const playlist = [{ title: "Narasimha Maha Mantra", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" }, { title: "Divine Flute", url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" }];
        let currentTrack = 0; let isPlaying = false; let audioPlayer;

        // --- BACKEND CONNECTION LOGIC ---
        let calendarEvents = [];

        async function fetchLiveEvents() {
            try {
                // A. Fetch Default Image Setting
                const settingRes = await fetch('http://localhost:5001/api/settings/default_event_image');
                const settingData = await settingRes.json();
                if (settingData.value) globalDefaultImage = settingData.value;

                // B. Fetch Events
                const response = await fetch('http://localhost:5001/api/events');
                const realData = await response.json();
                calendarEvents = realData.map(event => ({
                    _id: event._id,
                    date: new Date(event.date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }),
                    title: event.title,
                    desc: event.description || event.location,
                    image: event.image
                }));
                renderCalendar();
            } catch (error) { console.error("‚ùå Connection Error:", error); }
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-events-container');
            if(!container) return;
            container.className = "grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6";
            container.innerHTML = '';
            calendarEvents.forEach(event => {
                const el = document.createElement('div');
                el.className = "glass-panel rounded-xl overflow-hidden hover:scale-105 transition duration-300 relative group border border-white/20 flex flex-col";
                const imageSrc = event.image ? event.image : globalDefaultImage;
                el.innerHTML = `
                    <img src="${imageSrc}" class="w-full h-48 object-cover group-hover:opacity-90 transition">
                    <div class="absolute top-3 right-3 bg-black/60 backdrop-blur-md text-white px-3 py-1 rounded-lg text-center border border-white/20 shadow-lg">
                        <span class="block text-xl font-bold leading-none">${event.date.split(' ')[0]}</span>
                        <span class="text-[10px] uppercase font-bold text-secondary">${event.date.split(' ')[1]}</span>
                    </div>
                    <div class="p-5 flex-grow flex flex-col">
                        <h4 class="font-bold text-xl mb-2 text-primary leading-tight">${event.title}</h4>
                        <p class="text-sm opacity-80 mb-4 line-clamp-3">${event.desc}</p>
                    </div>`;
                container.appendChild(el);
            });
        }

        // --- ADMIN FUNCTIONS ---
        async function handleFormSubmit() {
            const title = document.getElementById('admin-event-title').value;
            const date = document.getElementById('admin-event-date').value;
            const desc = document.getElementById('admin-event-desc').value;
            const location = document.getElementById('admin-event-location').value;
            const imageUrl = document.getElementById('admin-event-image').value;
            const fileInput = document.getElementById('admin-event-file');

            if (!title || !date) { alert("Please fill in Title and Date!"); return; }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('date', date);
            formData.append('description', desc || "Temple Event");
            formData.append('location', location || "Temple Premises");

            if (fileInput && fileInput.files.length > 0) formData.append('imageFile', fileInput.files[0]);
            else if (imageUrl) formData.append('image', imageUrl);

            try {
                let url = 'http://localhost:5001/api/events';
                let method = 'POST';
                if (editingEventId) { url = `http://localhost:5001/api/events/${editingEventId}`; method = 'PUT'; }
                
                const response = await fetch(url, { method: method, body: formData });
                if (response.ok) {
                    alert(editingEventId ? "‚úÖ Event Updated!" : "‚úÖ Event Added!");
                    exitEditMode();
                    renderAdminEvents();
                    fetchLiveEvents();
                } else { alert("‚ùå Operation Failed"); }
            } catch (err) { console.error(err); }
        }

        async function renderAdminEvents() {
            const list = document.getElementById('admin-event-list');
            if (!list) return;
            list.innerHTML = '<p>Loading...</p>';
            try {
                const response = await fetch('http://localhost:5001/api/events');
                allAdminEvents = await response.json();
                list.innerHTML = '';
                allAdminEvents.forEach(event => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center bg-white/5 p-3 rounded mb-2 border border-white/10';
                    div.innerHTML = `
                        <div><h4 class="font-bold text-sm text-primary">${event.title}</h4><span class="text-xs opacity-70">${new Date(event.date).toDateString()}</span></div>
                        <div class="flex gap-2">
                            <button onclick="startEdit('${event._id}')" class="text-blue-400 p-2 bg-white/10 rounded"><i class="fas fa-edit"></i></button>
                            <button onclick="deleteEvent('${event._id}')" class="text-red-500 p-2 bg-white/10 rounded"><i class="fas fa-trash"></i></button>
                        </div>`;
                    list.appendChild(div);
                });
            } catch (err) { console.error(err); }
        }

        function startEdit(id) {
            const event = allAdminEvents.find(e => e._id === id);
            if (!event) return;
            document.getElementById('admin-event-title').value = event.title;
            if(event.date) document.getElementById('admin-event-date').value = event.date.split('T')[0];
            document.getElementById('admin-event-desc').value = event.description;
            document.getElementById('admin-event-location').value = event.location;
            document.getElementById('admin-event-image').value = event.image || '';
            editingEventId = id;
            const btn = document.getElementById('btn-submit-event');
            btn.innerText = "Update Event";
            btn.className = "flex-grow bg-blue-600 text-white font-bold py-2 rounded hover:bg-blue-700 transition";
            document.getElementById('btn-cancel-edit').classList.remove('hidden');
        }

        function exitEditMode() {
            editingEventId = null;
            document.getElementById('admin-event-title').value = '';
            document.getElementById('admin-event-date').value = '';
            document.getElementById('admin-event-desc').value = '';
            document.getElementById('admin-event-location').value = '';
            document.getElementById('admin-event-image').value = '';
            document.getElementById('admin-event-file').value = '';
            const btn = document.getElementById('btn-submit-event');
            btn.innerText = "Add Event to Calendar";
            btn.className = "flex-grow bg-primary text-white font-bold py-2 rounded hover:bg-orange-600 transition";
            document.getElementById('btn-cancel-edit').classList.add('hidden');
        }

        async function deleteEvent(id) {
            if (!confirm("Are you sure you want to delete?")) return;
            try {
                await fetch(`http://localhost:5001/api/events/${id}`, { method: 'DELETE' });
                renderAdminEvents();
                fetchLiveEvents();
            } catch (err) { console.error(err); }
        }

        async function saveDefaultImage() {
            const textUrl = document.getElementById('admin-default-url').value;
            const fileInput = document.getElementById('admin-default-file');
            if (!textUrl && (!fileInput || fileInput.files.length === 0)) { alert("Please provide a URL or File"); return; }
            const formData = new FormData();
            formData.append('key', 'default_event_image');
            formData.append('textValue', textUrl);
            if (fileInput && fileInput.files.length > 0) formData.append('imageFile', fileInput.files[0]);
            try {
                const response = await fetch('http://localhost:5001/api/settings', { method: 'POST', body: formData });
                if (response.ok) {
                   const msg = document.getElementById('default-save-msg');
                   msg.classList.remove('hidden');
                   setTimeout(() => msg.classList.add('hidden'), 3000);
                   fetchLiveEvents();
                }
            } catch (err) { console.error(err); }
        }

        // --- NAVIGATION & UI ---
        function renderNavigation() {
            const topContainer = document.getElementById('top-menu-items');
            const sideContainer = document.getElementById('side-menu-items');
            const dockContainer = document.getElementById('dock-items-container');
            const mobileContainer = document.getElementById('mobile-menu-links');
            let html = ''; let dockHtml = '';
            navItems.forEach(item => {
                let labelKey = item.labelKey;
                if (item.id === 'view-login' && state.user) {
                    labelKey = state.user === 'admin' ? 'navAdmin' : 'navMember';
                    item.tempId = state.user === 'admin' ? 'view-admin' : 'view-leela';
                }
                const label = translations[state.lang][labelKey] || "Link";
                const targetId = item.tempId || item.id;
                const isActive = targetId === state.activeView ? 'active' : '';
                html += `<button onclick="switchView('${targetId}')" class="nav-btn ${isActive} hover:text-primary transition text-left flex items-center gap-3 py-2 px-2 rounded"><i class="fas ${item.icon}"></i> ${label}</button>`;
                dockHtml += `<button onclick="switchView('${targetId}')" class="dock-item ${isActive} flex flex-col items-center justify-center text-xs gap-1 opacity-70 hover:opacity-100 p-2 relative group"><i class="fas ${item.icon} text-2xl mb-1"></i><span class="absolute -top-10 bg-black/80 text-white px-2 py-1 rounded text-xs opacity-0 group-hover:opacity-100 transition whitespace-nowrap">${label}</span></button>`;
                delete item.tempId;
            });
            if(topContainer) topContainer.innerHTML = html;
            if(sideContainer) sideContainer.innerHTML = html;
            if(mobileContainer) mobileContainer.innerHTML = html;
            if(dockContainer) dockContainer.innerHTML = dockHtml;
        }

        function switchView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hide'));
            document.getElementById(viewId).classList.remove('hide');
            state.activeView = viewId;
            renderNavigation();
            if(viewId === 'view-leela') checkLeelaAccess();
            window.scrollTo(0, 0);
        }

        function handleLogin(e) {
            e.preventDefault();
            const type = document.getElementById('login-type').value;
            const p = document.getElementById('password').value;
            if (type === 'admin' && p === 'admin9129') {
                state.user = 'admin';
                switchView('view-admin');
                renderAdminEvents();
            } else if (type === 'member' && p === 'member9129') {
                state.user = 'member';
                switchView('view-leela');
            } else {
                document.getElementById('login-msg').innerText = "Incorrect Password";
            }
        }
        function handleLogout() { state.user = null; switchView('view-home'); renderNavigation(); }
        function checkLeelaAccess() {
            const isAuth = state.user === 'member' || state.user === 'admin';
            document.getElementById('leela-public').classList.toggle('hide', isAuth);
            document.getElementById('leela-member-dashboard').classList.toggle('hide', !isAuth);
        }
        
        function toggleSettings() { document.getElementById('settings-modal').classList.toggle('hide'); }
        function toggleSearch() { document.getElementById('search-modal').classList.toggle('hide'); }
        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('-translate-y-full'); }
        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        
        function offerFlowers() {
            const container = document.getElementById('flower-container');
            const flowers = ['üå∏', 'üå∫', 'üåº', 'üåª', 'üåπ'];
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const f = document.createElement('div');
                    f.className = 'flower';
                    f.innerText = flowers[Math.floor(Math.random() * flowers.length)];
                    f.style.left = Math.random() * 100 + '%';
                    f.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    container.appendChild(f);
                    setTimeout(() => f.remove(), 4000);
                }, i * 200);
            }
            showToast("Pushpanjali Offered üôè");
        }
        
        function startShlokaRotation() {
            setInterval(() => {
                const el = document.getElementById('shloka-display');
                el.style.opacity = 0;
                setTimeout(() => {
                    currentShlokaIndex = (currentShlokaIndex + 1) % shlokas.length;
                    el.innerHTML = shlokas[currentShlokaIndex];
                    el.style.opacity = 1;
                }, 1000);
            }, 6000);
        }
        
        function initPanchang() {
            const now = new Date();
            const tithis = ["Pratipada", "Dwitiya", "Tritiya", "Chaturthi", "Panchami", "Shashti", "Saptami", "Ashtami", "Navami", "Dashami", "Ekadashi", "Dwadashi", "Trayodashi", "Chaturdashi", "Purnima/Amavasya"];
            const tithi = tithis[now.getDate() % 15];
            const text = `${now.toDateString()} | Tithi: ${tithi}`;
            document.getElementById('panchang-text').innerText = text;
        }
        
        function updateDarshanStatus() {
            const now = new Date();
            const currentHour = now.getHours();
            const isOpen = (currentHour >= 5 && currentHour < 12) || (currentHour >= 16 && currentHour < 21);
            const badge = document.getElementById('live-darshan-badge');
            const text = document.getElementById('darshan-status-text');
            const dot = badge.querySelector('i');
            if (isOpen) {
                text.innerText = "DARSHAN OPEN";
                dot.className = "fas fa-circle text-[10px] mr-1 text-green-400";
                badge.classList.add('border-green-400/50', 'text-green-100');
                badge.classList.remove('border-red-400/50', 'text-red-100');
            } else {
                text.innerText = "DARSHAN CLOSED";
                dot.className = "fas fa-circle text-[10px] mr-1 text-red-500";
                badge.classList.add('border-red-400/50', 'text-red-100');
                badge.classList.remove('border-green-400/50', 'text-green-100');
            }
        }
        
        function toggleJapaMala() { document.getElementById('mala-modal').classList.toggle('hide'); }
        function countMala() {
            state.malaCount++;
            document.getElementById('mala-count').innerText = state.malaCount;
            document.getElementById('bead-sound').currentTime = 0;
            document.getElementById('bead-sound').play();
            if (state.malaCount >= 108) {
                document.getElementById('bell-sound').play();
                showToast("Japa Complete! 108 üôè");
                state.malaCount = 0;
                setTimeout(() => document.getElementById('mala-count').innerText = 0, 2000);
            }
        }
        function resetMala() { state.malaCount = 0; document.getElementById('mala-count').innerText = 0; }
        
        function toggleOracle() { document.getElementById('oracle-modal').classList.toggle('hide'); if (!document.getElementById('oracle-modal').classList.contains('hide')) askOracle(); }
        function askOracle() {
            const msgEl = document.getElementById('oracle-msg');
            msgEl.style.opacity = 0;
            setTimeout(() => {
                const randomMsg = oracleMessages[Math.floor(Math.random() * oracleMessages.length)];
                msgEl.innerText = `"${randomMsg}"`;
                msgEl.style.opacity = 1;
            }, 300);
        }
        
        function toggleContactModal() { document.getElementById('contact-modal').classList.toggle('hide'); }
        function handleContactSubmit(e) { e.preventDefault(); toggleContactModal(); showToast("Message Sent Successfully! üôè"); }
        
        function toggleSankalp() { document.getElementById('sankalp-modal').classList.toggle('hide'); }
        function handleSankalpSubmit(e) {
            e.preventDefault();
            const name = document.getElementById('sankalp-name').value;
            const wish = document.getElementById('sankalp-wish').value;
            const container = document.getElementById('sankalp-marquee');
            container.innerHTML += `<div class="bg-white/10 p-2 rounded text-sm">${name}: ${wish}</div>`;
            toggleSankalp();
            showToast("Sankalp Submitted Successfully üôè");
        }
        
        function showToast(msg) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }
        
        function performSearch(inputEl) {
            const input = inputEl || document.getElementById('search-input');
            const query = input.value.toLowerCase();
            if(inputEl) { document.getElementById('search-input').value = input.value; document.getElementById('search-modal').classList.remove('hide'); }
            const resultsDiv = document.getElementById('search-results');
            resultsDiv.innerHTML = '';
            if (query.length < 2) { resultsDiv.innerHTML = '<p class="text-center opacity-50 text-sm py-4">Type more to search...</p>'; return; }
            const hits = [];
            calendarEvents.forEach(e => { if (e.title.toLowerCase().includes(query)) hits.push({ type: 'Event', title: e.title, link: 'view-calendar' }); });
            navItems.forEach(item => { if (translations[state.lang][item.labelKey].toLowerCase().includes(query)) hits.push({ type: 'Page', title: translations[state.lang][item.labelKey], link: item.id }); });
            hits.forEach(h => {
                const div = document.createElement('div');
                div.className = 'p-3 hover:bg-black/10 rounded cursor-pointer border-b border-gray-200 dark:border-gray-700 last:border-0';
                div.innerHTML = `<span class="text-xs font-bold text-primary uppercase">${h.type}</span><h4 class="font-bold">${h.title}</h4>`;
                div.onclick = () => { toggleSearch(); switchView(h.link); };
                resultsDiv.appendChild(div);
            });
        }
        
        function openImagePreview(element) {
            document.getElementById('preview-img-target').src = element.querySelector('img').src;
            document.getElementById('image-preview-modal').classList.remove('hide');
        }
        function closeImagePreview() { document.getElementById('image-preview-modal').classList.add('hide'); }
        function createSelfie(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const img = document.getElementById('preview-img-target');
                    img.src = e.target.result;
                    img.style.border = "20px solid #ea580c";
                    document.getElementById('image-preview-modal').classList.remove('hide');
                    showToast("Selfie Frame Applied! (Simulated)");
                };
                reader.readAsDataURL(file);
            }
        }
        function addToGallery(event) {
            const reader = new FileReader();
            reader.onload = function () {
                const grid = document.getElementById('gallery-grid');
                const div = document.createElement('div');
                div.className = 'gallery-item rounded-xl overflow-hidden shadow-lg h-64 group relative border border-white/20 cursor-pointer';
                div.onclick = function () { openImagePreview(this); };
                div.innerHTML = `<img src="${reader.result}" class="w-full h-full object-cover">`;
                grid.insertBefore(div, grid.firstChild);
            };
            reader.readAsDataURL(event.target.files[0]);
        }
        
        function setNavStyle(style) {
            state.navStyle = style;
            const body = document.body;
            const sideNav = document.getElementById('side-nav');
            const bottomNav = document.getElementById('bottom-nav');
            const topMenu = document.getElementById('top-menu-items');
            
            body.className = `min-h-screen overflow-x-hidden relative nav-${style}`;
            
            if (style === 'side') {
                sideNav.classList.remove('hide', '-translate-x-full');
                bottomNav.classList.add('hide');
                topMenu.classList.add('hide');
                document.getElementById('main-layout').style.paddingLeft = 'var(--side-nav-width)';
            } else if (style === 'bottom') {
                sideNav.classList.add('hide');
                bottomNav.classList.remove('hide');
                topMenu.classList.add('hide');
                document.getElementById('main-layout').style.paddingLeft = '0';
            } else {
                sideNav.classList.add('hide');
                bottomNav.classList.add('hide');
                topMenu.classList.remove('hide');
                document.getElementById('main-layout').style.paddingLeft = '0';
            }
            renderNavigation();
        }
        
        function changeLanguage(lang) { state.lang = lang; renderNavigation(); updateLanguage(); }
        function updateLanguage() {
            const data = translations[state.lang];
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (data[key]) el.innerText = data[key];
            });
        }
        
        function initSettingsUI() {
            const grid = document.getElementById('theme-grid');
            const adminGrid = document.getElementById('admin-theme-controls');
            const createBtn = (t, container) => {
                const btn = document.createElement('div');
                btn.className = 'w-8 h-8 md:w-10 md:h-10 rounded-full cursor-pointer border-2 border-transparent hover:scale-110 transition shadow-sm';
                btn.style.backgroundColor = t.colors.p;
                btn.onclick = () => applyTheme(t.id);
                btn.title = t.name;
                container.appendChild(btn);
            };
            themes.forEach(t => { createBtn(t, grid); createBtn(t, adminGrid); });
            document.querySelectorAll('.font-select').forEach(select => {
                fonts.forEach(f => {
                    const opt = document.createElement('option');
                    opt.value = f; opt.innerText = f; opt.style.fontFamily = f; select.appendChild(opt);
                });
            });
        }
        function applyTheme(themeId) {
            state.theme = themeId;
            const t = themes.find(x => x.id === themeId);
            const root = document.documentElement;
            root.style.setProperty('--primary', t.colors.p);
            if (!root.classList.contains('dark')) {
                root.style.setProperty('--bg', t.colors.bg);
                root.style.setProperty('--text', t.colors.t);
            }
        }
        function updateCustomFont(type, fontName) {
            if (type === 'heading') document.documentElement.style.setProperty('--heading-font', fontName);
            if (type === 'body') document.documentElement.style.setProperty('--body-font', fontName);
        }
        function updateShlokaStyle(prop, value) {
            if (prop === 'color') document.documentElement.style.setProperty('--shloka-color', value);
            if (prop === 'font') document.documentElement.style.setProperty('--shloka-font', value);
        }
        function adjustFontSize(delta) {
            const root = document.documentElement;
            const style = window.getComputedStyle(root).getPropertyValue('--font-size-base');
            root.style.setProperty('--font-size-base', (parseInt(style) + delta) + 'px');
        }
        function toggleDarkMode() {
            const root = document.documentElement;
            root.classList.toggle('dark');
            if (root.classList.contains('dark')) {
                root.style.setProperty('--text', '#ffffff');
                root.style.setProperty('--bg', '#0a0a0a');
                root.style.setProperty('--primary', '#fb923c');
            } else {
                applyTheme(state.theme);
            }
        }
        
        function startCountdown(dateString) {
            setInterval(() => {
                const now = new Date().getTime();
                const target = new Date(dateString).getTime();
                const d = target - now;
                if (d < 0) return;
                document.getElementById("days").innerText = Math.floor(d / (1000 * 60 * 60 * 24));
                document.getElementById("hours").innerText = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                document.getElementById("minutes").innerText = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
                document.getElementById("seconds").innerText = Math.floor((d % (1000 * 60)) / 1000);
            }, 1000);
        }
        
        function shareApp() {
            const data = { title: "Sri Narsimha Temple", text: "Join me in virtual darshan!", url: window.location.href };
            if (navigator.share) navigator.share(data);
            else { navigator.clipboard.writeText(window.location.href); showToast("Link Copied!"); }
        }
        
        function togglePlayerOverlay() { document.getElementById('player-overlay').classList.toggle('hide'); }
        function togglePlayerCollapse() { document.getElementById('global-player-ui').classList.toggle('player-collapsed'); }
        function playBhajan(name) { showToast(`Now Playing: ${name}`); }
        function audioToggle() { 
            audioPlayer = document.getElementById('global-audio-player');
            if(audioPlayer.paused) audioPlayer.play(); else audioPlayer.pause(); 
        }
        function audioNext() { loadTrack(currentTrack + 1); }
        function audioPrev() { loadTrack(currentTrack - 1); }
        function loadTrack(idx) {
            if(idx < 0) idx = playlist.length - 1;
            if(idx >= playlist.length) idx = 0;
            currentTrack = idx;
            audioPlayer = document.getElementById('global-audio-player');
            audioPlayer.src = playlist[idx].url;
            audioPlayer.play();
            document.getElementById('player-title').innerText = playlist[idx].title;
            document.getElementById('overlay-title').innerText = playlist[idx].title;
        }
        
        function initSideNavResizer() {
            const resizer = document.getElementById('side-nav-resizer');
            const sideNav = document.getElementById('side-nav');
            let isResizing = false;
            resizer.addEventListener('mousedown', (e) => { isResizing = true; document.addEventListener('mousemove', resize); document.addEventListener('mouseup', stopResize); });
            function resize(e) { if(isResizing) document.documentElement.style.setProperty('--side-nav-width', e.clientX + 'px'); }
            function stopResize() { isResizing = false; document.removeEventListener('mousemove', resize); }
        }

        function renderAdminFeatures() {
            const container = document.getElementById('admin-feature-toggles');
            container.innerHTML = '';
            Object.keys(state.features).forEach(key => {
                const isOn = state.features[key];
                const div = document.createElement('div');
                div.className = `p-3 rounded cursor-pointer border flex justify-between items-center ${isOn ? 'bg-green-600/20 border-green-500' : 'bg-red-600/20 border-red-500'}`;
                div.onclick = () => toggleFeature(key);
                div.innerHTML = `<span class="capitalize font-bold">${key}</span> <i class="fas ${isOn ? 'fa-check-circle text-green-400' : 'fa-times-circle text-red-400'}"></i>`;
                container.appendChild(div);
            });
        }
        function toggleFeature(key) { state.features[key] = !state.features[key]; renderAdminFeatures(); applyFeatureStates(); showToast(`${key} is now ${state.features[key] ? 'Enabled' : 'Disabled'}`); }
        function applyFeatureStates() { document.querySelectorAll('[data-feature]').forEach(el => { const key = el.getAttribute('data-feature'); if (state.features[key] === false) el.classList.add('hide'); else el.classList.remove('hide'); }); }
        
        // --- EXTRA ADMIN FUNCTION STUBS ---
        function updateHeading() { const val = document.getElementById('admin-heading-input').value; if(val) { document.getElementById('main-heading-display').innerText = val; alert('Heading Updated!'); }}
        function updateTicker() { const val = document.getElementById('admin-ticker-input').value; if(val) { document.getElementById('announcement-text').innerText = val; alert('Ticker Updated'); }}
        function updateMelaDate() { const val = document.getElementById('admin-date-input').value; if(val) { state.melaDate = val; document.getElementById('mela-date-display').innerText = new Date(val).toDateString(); startCountdown(val); alert('Date Updated!'); }}
        function updateMainPhoto() { const fileInput = document.getElementById('admin-photo-file'); const urlInput = document.getElementById('admin-photo-url'); if (fileInput.files && fileInput.files[0]) { const reader = new FileReader(); reader.onload = function (e) { document.getElementById('main-idol-img').src = e.target.result; alert('Photo Set!'); }; reader.readAsDataURL(fileInput.files[0]); } else if (urlInput.value) { document.getElementById('main-idol-img').src = urlInput.value; alert('Photo Set!'); }}
        function updateMainPhotoFocus(focus) { const img = document.getElementById('main-idol-img'); img.style.objectPosition = focus; }
        function setDefaultNav(val) { setNavStyle(val); alert('Default Navigation Style Set!'); }
        function addBhajan() { const title = document.getElementById('bhajan-title').value; if (title) { alert('Bhajan Added (Simulated)!'); document.getElementById('bhajan-title').value = ''; } }
        function renderAdminPlaylist() { const list = document.getElementById('admin-playlist-list'); list.innerHTML = ''; playlist.forEach((track, idx) => { const div = document.createElement('div'); div.className = 'flex justify-between items-center bg-white/5 p-2 rounded'; div.innerHTML = `<span class="truncate pr-2">${idx + 1}. ${track.title}</span><button onclick="removeFromPlaylist(${idx})" class="text-red-500 hover:text-red-400"><i class="fas fa-trash"></i></button>`; list.appendChild(div); }); }
        function addToPlaylist() { const t = document.getElementById('playlist-title').value; const u = document.getElementById('playlist-url').value; if (t && u) { playlist.push({ title: t, url: u }); renderAdminPlaylist(); renderUserPlaylist(); document.getElementById('playlist-title').value = ''; document.getElementById('playlist-url').value = ''; if (playlist.length === 1) loadTrack(0); } }
        function uploadAudio() { const fileInput = document.getElementById('playlist-file'); const file = fileInput.files[0]; if (file) { const reader = new FileReader(); reader.onload = function (e) { const title = file.name.replace(/\.[^/.]+$/, ""); playlist.push({ title: title, url: e.target.result }); renderAdminPlaylist(); renderUserPlaylist(); if (playlist.length === 1) loadTrack(0); alert("Audio Uploaded Successfully!"); }; reader.readAsDataURL(file); } }
        function removeFromPlaylist(idx) { if (confirm('Remove track?')) { playlist.splice(idx, 1); renderAdminPlaylist(); renderUserPlaylist(); } }

        // --- INIT ---
        window.onload = function() {
            renderNavigation();
            fetchLiveEvents();
            startShlokaRotation();
            initPanchang();
            updateDarshanStatus();
            initSettingsUI();
            startCountdown(state.melaDate);
            initSideNavResizer();
            
            // Auto-play ambient audio
            audioPlayer = document.getElementById('global-audio-player');
            audioPlayer.src = playlist[0].url;
            document.getElementById('player-title').innerText = playlist[0].title;
            
            setInterval(updateDarshanStatus, 60000);
            
            // Welcome
            setTimeout(() => {
                document.getElementById('welcome-popup').classList.remove('hide');
                setTimeout(() => document.getElementById('welcome-popup').classList.add('hide'), 5000);
            }, 1000);
        };
    </script>
</body>

</html>